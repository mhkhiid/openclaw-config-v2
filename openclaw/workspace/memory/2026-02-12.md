# 2026-02-12 工作日志

## GitHub 备份自动化修复

### 问题 1：备份文件过大导致推送失败
- **现象**：GitHub push 被 SIGKILL，仓库有 73,390 个文件（~2GB）
- **原因**：包含了 browser 缓存文件（72,000+ 文件，1.9GB）
- **解决**：
  - 修改 `backup-daily.sh`，添加 `--exclude='browser'`
  - 删除备份目录中的 browser 文件
  - 文件数量从 73,390 降至 1,144

### 问题 2：GitHub Secret 扫描阻止推送
- **现象**：`GH013: Repository rule violations found` - Push cannot contain secrets
- **原因**：session 文件 `.jsonl` 中包含 OAuth token
- **解决**：
  - 修改 `backup-daily.sh`，添加 `--exclude='sessions/*.jsonl'`
  - 创建 `.gitignore` 排除敏感文件：
    - `openclaw/agents/main/agent/auth-profiles.json`
    - `openclaw/identity/device-auth.json`

### 问题 3：Cron 任务无法访问 GitHub 凭证
- **现象**：`could not read Username for 'https://github.com': Device not configured`
- **原因**：Cron 环境缺少 GitHub CLI 认证
- **解决**：脚本中已包含 `gh auth setup-git`，手动运行后已修复

### 问题 4：敏感文件仍在 Git 历史中存在
- **现象**：GitHub 扫描发现仓库中仍包含敏感文件
- **原因**：`git rm` 仅从当前提交移除，但历史记录中仍存在
- **解决**：
  - 使用 `git rm --cached` 移除所有敏感文件
  - 共移除 80 个文件：auth-profiles.json (4个), device-auth.json (1个), sessions/*.jsonl (75个)
  - 新提交：`193b3d0` - Remove sensitive files from tracking

### 最终状态
- ✅ 新仓库：`mhkhiid/openclaw-config-v2`
- ✅ 最新提交：`193b3d0` - Remove sensitive files from tracking
- ✅ 备份文件：约 1,100 个（排除 browser + sessions + 敏感文件）
- ✅ 敏感文件仅存在于本地，不再上传到 GitHub
- ✅ 明日 3:00 AM 自动备份应能正常工作

## 重要决策记录

**Alex 明确指示（2026-02-12）**：
1. > 涉及到删库的情形，必须要获得我的同意
2. > 绝不能把 apikey 等敏感文件上传到 GitHub 或任何这类平台（private 也不行）

已记入 MEMORY.md 边界规则。

## 技术债务

- 旧仓库 `mhkhiid/openclaw-config` 仍存在（可手动删除）
- 需观察明日自动备份是否正常运行
